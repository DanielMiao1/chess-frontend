<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Game</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://cdn.socket.io/">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed&family=Bebas+Neue&display=swap" rel="stylesheet"> 
		<link rel="stylesheet" href="/static/index.css">
		<link rel="stylesheet" href="/static/board.css">
		<link rel="stylesheet" href="/static/analysis.css">
	</head>
	<body>
		<header>
			<h1><a href="/">Multiplayer Online Chess</a></h1>
			<nav>
				<ul>
					<li><a href="/games.html">Games</a></li>
					<li><a href="/analysis.html">Analysis</a></li>
				</ul>
			</nav>
		</header>
		<div class="board-wrapper"></div>
		<script src="https://cdn.socket.io/4.5.0/socket.io.min.js" integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k" crossorigin="anonymous"></script>
		<script src="/static/games.js"></script>
		<script src="/static/board.js"></script>
		<script>
			function startGame(pieces) {
				game.reconstructPieces(pieces);
			};

      const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
      });
			let element = document.getElementsByClassName("board-wrapper")[0];
			let game = board(element);
			let type;

			var socket = io(validation_url);
			socket.on("state", function(board) {
				startGame(JSON.parse(board))
			});
			socket.on("type", function(game_type) {
				type = parseInt(game_type);
			});
			socket.emit("state", params.id.toString())
      // fetch(validation_url + "/state/" + params.id.toString()).then(function(response) {
      //   return response.json();
      // }).then(function(response) {
      //   startGame(response);
      // });
		</script>
	</body>
</html>